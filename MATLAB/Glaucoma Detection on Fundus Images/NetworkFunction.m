function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [0.004156927;1.48e-07;0.004191177];
x1_step1_gain = [0.320976250343901;1.19453947908552e-06;1.18469148313356e-06];
x1_step1_ymin = -1;

% Layer 1
b1 = [-6.4993321227551446;-6.3730081634721873;6.2363271327376388;-6.1074133765283012;-5.9731100264606232;5.8502426431995413;5.7105268692171354;5.579256186847477;-5.4699000946511038;-5.3170846864760213;5.1832415660337858;-5.0555905109110961;4.9197560319686655;-4.7961869533372194;-4.6586344876059229;-4.5290362508248974;-4.3956318048225178;4.2664166071827037;-4.1363652216723956;4.0041172528569051;3.8726783978618777;-3.7414025521621821;3.6101243910984833;3.4788470226102137;-3.3499343782994333;3.1952371192650668;-3.0771506085197875;2.9529075631068689;2.8169048034533297;-3.6345954532927363;-2.5599070427688657;2.4776179855776927;2.2973520927776421;2.1660757668045001;-1.9965480396471227;1.9524193518049657;0.89579270185432436;-1.6488264233976444;-1.5093824344874045;-1.378411421625733;1.2471300098759639;-1.1142359298701396;-0.89987415283694872;-0.86307426991255776;-0.72202492382537597;0.59078166875327576;-0.44815430786742888;0.34176750599200045;0.19691487421672574;-0.059563049056522377;-0.096339919779086597;-0.20309569939576733;0.11053302196375525;0.30996914855063773;-0.59206053926282554;-0.7115428579525519;-0.85317997064173146;-0.9853498328062581;-1.1158573188934051;-1.247151927860868;1.3783964101830841;1.5103667887151369;1.640965698186625;-1.7722429414655942;-1.9035203648263701;-2.0635489015446651;2.1660745505486867;2.291212566822296;2.2685452053614537;-2.5598971679105818;-2.6660395721731986;-2.706461741536355;2.9537483224170611;3.0850202931165964;-3.2139774933188492;-3.3475489819539872;-3.4755282051412855;3.6182871031321913;3.7413401287251205;3.8726785802925314;4.0039189320870916;-4.1472746362554416;-4.2650835966407783;-4.3974291461081476;4.8440231444934856;-4.6603449177107201;-4.781731861998419;-4.9228985194040566;5.0398761398697136;5.185436766690966;-5.3199189456471867;5.4480460080481263;5.6001173375938285;5.6121106924141184;-5.8404861961474372;5.8007439700487105;6.1017854125217683;-6.2161472179817086;-6.3672925393895312;-6.4971642080358576];
IW1_1 = [1.1969063209985762 1.2443560356953394 -6.2632909715236087;1.7971893101862133 -2.9112407342964643 -5.5184440254997886;-3.1621282132047539 -1.4292139948314493 5.4930123876343364;3.9586603452583589 -2.9617738992290534 -4.2167036127998543;4.7122796908073923 -4.3678805521987663 0.9710636645277908;-2.902570899347741 5.3084875066916322 -2.3825095817846456;-4.1690449780115548 -2.7311405718253274 4.1698368478177761;-4.6558077458152116 4.1884742043306078 -1.7340694086448196;0.38681642614067169 -5.8356008150700784 2.7772671143567997;3.5035029461694416 -0.83150405932149374 5.4091671675334672;-2.0764560329382395 -4.3984265587272917 -4.3104014143481795;5.4306851173996034 -3.5162821462671836 -0.59892968539221747;-0.67170453512244666 4.7813935830502254 -4.3541389962561174;0.77168060073599576 5.4412486207600486 3.4636909462093066;4.4100679818214559 -2.9646100252361913 3.7416966732593746;2.7017554159864772 0.5108642094133633 -5.8878629025484317;5.9540062638329783 -2.589700781815981 0.25040636236063002;-4.5821807786851423 4.5688587634514164 0.59697475628643049;4.2654844443611681 -4.4830820668124431 1.985917328712153;-5.09032492930179 3.3138670060579996 -2.3091897195768625;-4.8164344370021492 -4.1631689890193675 1.3026578371485364;2.1481262934521026 3.6149111869269421 -4.9542787305136793;-2.5080673957951309 -5.174502006583773 3.0267229647134672;-2.95274573644671 -4.7927695590541122 3.2461638715446424;4.6630455008828742 -4.4801999410770703 -0.63378492375318518;-2.0590753612691657 5.0213829549378586 -3.6047605430994292;3.9393489796474723 -4.2905751768618545 -2.8660734802929095;-1.4509641882885629 5.1653918777961438 3.6664072995309627;-2.5511649071428075 -5.5714850697076628 -2.1755676182114119;4.9421431754724638 -2.2804130904165398 3.0284726971313596;0.85420775847299957 4.5400545016198395 -4.5700268595973101;-5.543480248807958 -0.45263317512218898 -3.296042264819897;-2.1626358160788475 -4.5988287862795927 4.0497776698582157;-5.8503806954830173 -0.62318725857693225 2.7589105761399502;0.98750372044208079 5.114556055408686 3.9171463962208311;-3.3324345712175809 4.3100073778566941 3.4988777601691514;0.7764852010494091 -1.7428219957724655 -6.3607897899467263;4.1435249084859542 -4.7573148373257377 -1.5381059160519657;4.8754331205186503 3.5530605804999462 2.4157540753599958;3.7840504361979095 -0.89777336305356781 -5.2059469412160091;-6.1960184889965388 0.10456826285096284 1.9558612583898374;4.7797689993167811 -3.428943558241667 -2.762125537764021;4.4509388094910713 -3.4155492797919469 3.2491916539567227;1.2838585734549801 4.8987474767384001 4.0695353786211923;4.4106910126659278 4.7505825577596017 -0.45242698567120931;-4.8334350494429232 -3.1371942174070879 -3.003760787911137;3.7675325199377232 3.0708607054762842 4.31628616294305;-3.9004523730583309 3.5189668937863545 -3.8174151022450244;-0.26690745575547126 6.2870649445435065 -1.6212654320586071;-4.7335695430953306 4.4438267461256311 -0.16427713340929831;-4.1742305679861849 4.1942537117811929 2.6685256028481095;-3.3729043892354964 -3.3687150576314289 -4.4156558714608645;1.5523832568189948 -3.5455619044297149 -5.2790984173285542;4.6137191552809655 -1.6895716507343326 4.2458631686410833;-1.7137753547771806 -5.3904315451763347 -3.1984484872166372;-4.6063350807923555 -2.3914603942322779 -3.9146694599454572;-3.6658805047701701 3.8870593661956998 -3.6985073397132258;-4.9187201509436225 -2.0739757275669568 -3.7052083390517114;-6.4068956976528453 1.0728559232672479 0.16605419301007271;-5.0926136045317429 1.1741474276964012 3.8617809566741017;4.55575160000443 3.8619160635877985 2.5608080296480082;3.4178895607888706 -1.5143050107863478 -5.3145133713033657;3.0447167620378659 2.3254886050983075 -5.2486877831382293;-5.2406705822934994 -3.3184864284305977 1.9364764068981042;-4.2764076107425444 -4.8887279827661825 -0.19898463319729306;-5.7532036293839326 2.9933090152656026 -0.1739651252258414;5.3903471583366143 2.5765100379555808 -2.5559103932409974;5.6512068383630769 -2.423970625562522 -2.1136012536504896;5.1346721650859166 0.8813120717535996 3.8563316823981668;-4.0742859692711155 -4.887039441247337 -1.3206493593433237;-3.0380123845400746 4.4636022882286772 3.7027746224054781;-4.4990889314637927 -2.0013956462366931 -4.1061380966447345;3.0355501857141314 2.4817619253813161 -5.1819907962117444;3.6438467567379371 2.2300072523909975 -4.8965580690158612;-3.5913602973821068 5.3726890360411899 0.67875973084293906;-1.2390909948293889 -5.6119118933079148 3.0328840611644621;-4.6203275127355363 0.99421718713787177 4.4649218765133867;1.5718641745478581 -4.2389013596131404 -4.6633324106125853;4.1455196998409196 0.6551922335264837 -4.9611830662294087;4.6667961848027435 4.4513795577593944 -0.79571594136750901;3.2637489473646242 -5.2534733929086777 -1.9939011534853559;-0.9714677048149073 -2.4775075688447288 -5.9214488422335156;-2.447692293580972 3.3652015560750028 4.765389280603431;-4.9726232262358652 4.0297152971068622 -1.1234881798075138;5.5287988125376417 -0.2985159852245442 2.9916785847018481;-4.0254075594104437 5.0553633271496441 0.68297323709263413;-4.5674602743241941 -0.66827148162467032 -4.5780821448783415;-4.0916593910610555 -4.2316586881073279 2.7528681192991087;6.0107273877403182 -0.35201225213177528 -2.4847550849733215;2.5309521837649962 -4.925855941801049 -3.3995893619723772;-2.0498057112405816 -6.1211841849967179 -0.71340267551531733;5.2359612376127291 -3.3981784377697184 1.8066335534257982;2.6007346502020288 3.8347894502833686 4.5408403242279647;4.3458021265222762 4.3886288034005219 2.3455509709019773;-0.58717913307665448 4.5368349119127513 -4.6173705513198176;5.0763386902173471 3.0779481430444062 3.0536728276511647;5.2310083305611208 1.1824074344491182 -3.675768212040889;-5.4243827697286013 -0.56913310823367058 3.5779609138500907;-5.0896838324395537 -3.0240305907486329 2.6778008709215952;-0.40734054602544922 5.9981604143687832 2.4678092057020051];

% Layer 2
b2 = 0.61889979081037949;
LW2_1 = [-0.23571314536272281 -0.75286319989539718 1.0045787038642389 0.44005338919841763 -0.4293913416180174 -0.931009693899159 -0.51094819194401986 0.69288735007159774 -0.5780324659096856 0.075584989231183397 0.70754160458647131 -0.49897238127579102 -0.095869576937550424 0.33797605747070925 0.30524848766834106 0.32464865965815592 -0.35276624497559539 -0.26484521036706343 0.7102070826256297 0.75226306746313854 -0.053493720930202826 -0.39445578010094173 -0.11419355038606845 -0.37921772121056863 -0.33500685828296389 -0.7148418081739899 -0.51755505062057028 -0.15947270700101293 -0.81638425984981322 0.44144525657223777 -0.71010956061374897 -0.56530376060285703 0.44250894962289272 0.35685204499725609 -0.4059964022738648 -0.83667324949004718 0.24822356595654704 -0.084716138577417194 0.56928703937499969 -0.11249016868928541 -0.79368648238518968 0.60358255031397601 -0.14175216240355082 -0.16672360342727807 0.059662954957404653 0.060701093095735285 0.23234867656265326 0.30933597597889601 -0.62339983533171228 0.57014825129665148 -0.6245165237270428 -0.17168402333822722 -0.3065898478698374 -0.64585263149902472 -0.97592855759348884 0.85916559920266611 0.033529397121730233 -0.069424215011056056 0.054134381505124736 -0.31934154483180566 -0.34228386053284443 0.96986135358160941 -0.05962743358921524 0.50078353120938623 0.34697952169358942 0.63185248981338238 -0.4619746117809399 -0.4320401269206825 -0.38284781200110707 -0.62365658204288277 0.87562642680094527 0.26301550282864394 0.89947513054812356 0.43803962881860659 -0.62069429081054794 0.71323174317002969 0.86852320537953698 -0.014872342581881665 -0.20926240073881647 -0.1238542023305898 0.29113889681248978 -0.353494081466317 -0.48744487144401294 1.0084000152862831 0.65714982002244771 0.67123357563141406 1.0961347134816803 -0.017857903079392688 -0.74136198461115355 -0.18363967260608258 0.49556180160605451 0.23445701838228913 0.62166912839520028 0.46763707799414533 0.22436026236650475 -0.92208047263969517 -0.3303105768028462 0.66381466408653456 -0.22192295805629245 -0.72767034501386108];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 1;
y1_step1_xoffset = 1;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
